var E=Object.defineProperty;var x=(n,t,e)=>t in n?E(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(x(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const l={CONTROLLER_URL:"https://lyrx.dev/living_space/controller",SYNC_SERVER_URL:"wss://living-space-broadcaster.lyrx.dev",DEBUG_INFO:!1,ASSERTS:!1,DEBUG_VISUAL:!1,CONSTANT_TIME_S:0,COUNT_START_CREATURES:0,QR:!0};for(const n in l){const t=new URLSearchParams(window.location.search).get(n);t!==null&&(typeof l[n]=="boolean"?l[n]=t==="true":typeof l[n]=="number"?l[n]=parseFloat(t):l[n]=t)}class d{constructor(t,e,s,r){a(this,"c");if(l.ASSERTS&&(!Number.isInteger(t)||typeof e<"u"&&!Number.isInteger(e)||typeof s<"u"&&!Number.isInteger(s)||typeof e<"u"&&!Number.isInteger(e)||typeof r<"u"&&!Number.isInteger(r)))throw Error("has to be an integer");if(t instanceof Uint8ClampedArray||Array.isArray(t)){if(t.length===3){this.c=[...t,255];return}if(t.length===4){this.c=t;return}throw Error(`invalid length ${t.length} for color given`)}if(typeof e>"u"||typeof s>"u")throw Error("Color has to have 3 or 4 elements");this.c=[t,e,s,255],typeof r<"u"&&this.c.push(r)}static fromHex(t){const e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(s,r,i,o)=>"#"+r+r+i+i+o+o).substring(1).match(/.{2}/g).map(s=>parseInt(s,16));return new d(e)}get r(){return this.c[0]}set r(t){this.c[0]=t}get g(){return this.c[1]}set g(t){this.c[1]=t}get b(){return this.c[2]}set b(t){this.c[2]=t}get a(){return this.c[3]}set a(t){this.c[3]=t}mix(t){return new d((this.r+t.r)/2,(this.g+t.g)/2,(this.b+t.b)/2,(this.a+t.a)/2)}clone(){return new d(this.r,this.g,this.b)}scale(t){return this.r*=t,this.g*=t,this.b*=t,this.normalize()}normalize(){return this.r=Math.floor(this.r),this.g=Math.floor(this.g),this.b=Math.floor(this.b),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}gradient(t,e){let s=t.r-this.r;return this.r+=Math.sign(s)*Math.abs(s)*e,s=t.g-this.g,this.g+=Math.sign(s)*Math.abs(s)*e,s=t.b-this.b,this.b+=Math.sign(s)*Math.abs(s)*e,s=t.a-this.a,this.a+=Math.sign(s)*Math.abs(s)*e,this.normalize()}rgb(){return`rgb(${this.r}, ${this.g}, ${this.b})`}u32(){return this.r<<16|this.g<<8|this.b}}async function I(n){return console.log(`Connecting to ${n}`),await new Promise((t,e)=>{const s=new N(n);let r=!1;s.on("error",()=>{r=!0,s.close(),e(new Error(`connection to ${n} failed`))}),s.on("open",()=>{r=!0,t(s)}),setTimeout(()=>{r||(s.close(),e(new Error("connection timed out")))},8e3)})}class N{constructor(t){a(this,"socket");this.socket=new WebSocket(t)}on(t,e){switch(t){case"message":this.socket.addEventListener("message",s=>{e(JSON.parse(s.data))});break;case"open":case"error":case"close":this.socket.addEventListener(t,s=>{e(s)})}}send(t){this.socket.send(JSON.stringify(t))}close(){this.socket.close()}connected(){return this.socket.readyState===1}}function c(n,t){return(n%t+t)%t}function T(n,t,e){const s=document.createElement("div");s.classList.add(`message-${n}`,"message"),s.textContent=t;const r=document.getElementById("messages");return r==null||r.appendChild(s),e!==void 0&&setTimeout(()=>{s.remove()},e*1e3),s}function L(n,t){return n instanceof Error?n=n.message:typeof n!="string"&&(n=JSON.stringify(n)),console.error(n),T("error",n,t===!0?void 0:8)}function f(n){return parseFloat(n.toFixed(2))}function A(n){return parseFloat(n.toFixed(4))}class u{constructor(t){a(this,"p");a(this,"f");this.p=t,this.f=this.fromProbabilities(t)}static fromPMF(t){return new u(t.p)}static uniform(t){const e=new Array(t).fill(f(1/t));return new u(e)}static fromWeights(t){const e=t.reduce((r,i)=>{if(i<0)throw Error("can't give negative values to cdf");return r+i},0);console.assert(e>0,e,t);const s=t.map(r=>f(r/e));return new u(s)}fromProbabilities(t){let e=0;const s=t.map(r=>(e+=r,e>1?1:f(e)));if(l.ASSERTS){const r=f(t.reduce((i,o)=>i+o));console.assert(r===1,r)}return s[s.length-1]=1,s}[Symbol.iterator](){return this.f[Symbol.iterator]()}clone(){return new u([...this.p])}updateWeight(t,e){this.p[t]=e;const s=u.fromWeights(this.p);this.f=s.f,this.p=s.p}add(t){const e=t.p;for(let s=0;s<this.p.length;s++)this.p[s]=f((this.p[s]+e[s])/2);return this.f=this.fromProbabilities(this.p),this}draw(){const t=Math.random();return this.f.findIndex(e=>t<e)}}class p extends Array{constructor(...t){if(typeof t[0]>"u")throw Error("can't create empty vector");typeof t[0]=="number"?super(...t):super(...t[0]),Object.setPrototypeOf(this,p.prototype)}get length(){return super.length}push(){throw new Error("Cannot add items to FixedSizeArray")}pop(){throw new Error("Cannot remove items from FixedSizeArray")}clone(){return new p(...this)}mutmap(t){for(let e=0;e<this.length;e++)this[e]=t(this[e],e,this);return this}get(t){return this[t]}set(t,e){this[t]=e}add(t){for(let e=0;e<this.length;e++)this[e]+=t[e];return this}norm(){const t=this.mag2();if(t===0)return this;const e=1/Math.sqrt(t);if(e===0)return this;for(let s=0;s<this.length;s++)this[s]*=e;return this}sub(t){for(let e=0;e<this.length;e++)this[e]-=t.get(e);return this}roundTwoDec(){for(let t=0;t<this.length;t++)this[t]=f(this[t]);return this}round(){for(let t=0;t<this.length;t++)this[t]=Math.round(this[t]);return this}mul(t){for(let e=0;e<this.length;e++)this[e]*=t;return this}floor(){for(let t=0;t<this.length;t++)this[t]=Math.floor(this[t]);return this}scale(t){for(let e=0;e<this.length;e++)this[e]*=t;return this}mean(){return this.average()}average(){return this.sum()/this.length}mag2(){let t=0;for(let e=0;e<this.length;e++)t+=this.get(e)**2;return t}sum(){let t=0;for(let e=0;e<this.length;e++)t+=this.get(e);return t}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}}function h(...n){return new p(...n)}const O=[h(0,0),h(1,0),h(1,-1),h(0,-1),h(-1,-1),h(-1,0),h(-1,1),h(0,1),h(1,1)];class M{constructor(t,e){a(this,"name");a(this,"ancestors");a(this,"position");a(this,"color");a(this,"coloringPercentage");a(this,"coloringSpread");a(this,"speed");a(this,"attraction");a(this,"viewport");a(this,"personality");a(this,"preference");a(this,"walk");this.name=t,this.ancestors=e.ancestors,this.position=e.position,this.color=e.color;const s=e.personality,r=new p(Object.values(e.personality)).sum(),i=s.openness/r,o=s.conscientiousness/r,m=s.extraversion/r,g=s.agreeableness/r,w=s.neuroticism/r;this.speed=1+Math.round(4*m+2*i),this.coloringSpread=10+Math.round(10*g),this.coloringPercentage=A(.015+.05*w);const y=h(...Array.from({length:9},b=>Math.random())).roundTwoDec(),v=y.mean(),S=1+.2*(1-o)+.8*w;y.mutmap(b=>b*(1-(v-b)*S)).roundTwoDec(),y[0]*=1.5-i,this.preference=u.fromWeights(y),this.attraction=f((s.conscientiousness-50)/50),this.walk=this.preference.clone(),this.viewport=.25+m,this.personality=s}static random(t){const e=()=>Math.floor(Math.random()*window.innerWidth),s=()=>Math.floor(Math.random()*window.innerHeight),r=()=>Math.floor(Math.random()*255),i=()=>Math.floor(Math.random()*100);return new M(Math.random(),{position:h(e(),s()),color:new d(r(),r(),r()),ancestors:new Set,personality:{openness:i(),conscientiousness:i(),extraversion:i(),agreeableness:i(),neuroticism:i()},...t})}update(){this.walk=this.preference}updateWalk(t){const e=Math.atan2(-t.y,t.x),s=c(e,2*Math.PI),r=Math.floor(c(s+Math.PI/8,2*Math.PI)/(Math.PI/4)),i=m=>{const g=.125+2*m*this.attraction;return g<0?1:1+g},o=[...this.preference.p];o[1+c(r-4,8)]*=i(-3/8),o[1+c(r-3,8)]*=i(-1/8),o[1+c(r+3,8)]*=i(-1/8),o[1+c(r-2,8)]*=1/8,o[1+c(r+2,8)]*=1/8,o[1+c(r-1,8)]*=i(1/8),o[1+c(r+1,8)]*=i(1/8),o[1+r]*=i(3/8),this.walk=u.fromWeights(o)}procreate(t){if(t.ancestors.has(this.name)||this.ancestors.has(t.name))return null;if(Math.random()<this.personality.agreeableness/100){const e=this.ancestors.union(t.ancestors);return e.add(this.name),e.add(t.name),this.attraction*=.9,t.attraction*=.9,{ancestors:e,position:this.position.clone(),size:(this.size+t.size)/2,color:this.color.mix(t.color),personality:{openness:(this.personality.openness+t.personality.openness)/2,conscientiousness:(this.personality.conscientiousness+t.personality.conscientiousness)/2,extraversion:(this.personality.extraversion+t.personality.extraversion)/2,agreeableness:(this.personality.agreeableness+t.personality.agreeableness)/2,neuroticism:(this.personality.neuroticism+t.personality.neuroticism)/2}}}return null}step(){const t=this.walk.draw(),e=O[t];this.position.add(e.clone().scale(this.speed))}}export{l as C,d as a,M as b,I as c,L as e,h as v};
